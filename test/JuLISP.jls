(toplevel
    "ä¸»æ¨¡å—\n- åˆ©ç”¨Juliaä¸LISPç›¸ä¼¼çš„è¯­è¨€ç‰¹æ€§ï¼ŒæŠŠJuliaçš„è¯­æ³•ä»¥LISPçš„é£æ ¼é‡ç°\n  - å¯å°†Juliaçš„æŠ½è±¡è¯­æ³•æ ‘ã€Œæ­£å‘è½¬æ¢ã€æˆç±»LISPçš„S-è¡¨è¾¾å¼ï¼ˆæ•…ç§°ã€ŒJuLISPã€ï¼‰\n  - äº¦å¯å°†å­—ç¬¦ä¸²å½¢å¼çš„ã€ŒJuLISPã€åå‘è§£ææˆJuliaä»£ç \n"
    (module
        true
        JuLISP
        (block
            (export
                filter_expr
                expr2JuLISP)
            (export
                s_expr
                str2sexpr
                str2sexpr_all)
            (export
                sexpr2expr
                parse_julisp)
            (export
                run_julisp
                include_julisp
                @julisp_str
                @jls_str)
            (block
                "Juliaä»£ç  => Julia AST => JuLISP"
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "æŠŠè¡¨è¾¾å¼é‡Œé¢çš„LineNumberNodeå…¨éƒ¨å»æ‰â€”â€”å³ä¾¿æ˜¯å˜æˆæ„é€ å‡½æ•°ï¼Œä¹Ÿä¸åº”å½±å“ä»£ç "
                    (=
                        (call
                            filter_expr
                            (::
                                e
                                Any))
                        (block
                            e)))
                (=
                    (call
                        filter_expr
                        (::
                            e
                            Expr))
                    (block
                        (call
                            Expr
                            (.
                                e
                                (quote
                                    head))
                            (...
                                (call
                                    map
                                    filter_expr
                                    (call
                                        filter
                                        (->
                                            x
                                            (block
                                                (call
                                                    !
                                                    (call
                                                        isa
                                                        x
                                                        LineNumberNode))))
                                        (.
                                            e
                                            (quote
                                                args))))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "é»˜è®¤çš„ç¼©è¿›å•å…ƒï¼šå››ä¸ªç©ºæ ¼"
                    (const
                        (=
                            (::
                                DEFAULT_INDENT_UNIT
                                String)
                            "    ")))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "å°†Juliaè¯­æ³•æ ‘è½¬æ¢æˆLispé£æ ¼ï¼Œç®€ç§°ã€ŒJuLISPã€\n- å¯é€‰\n"
                    (=
                        (::
                            (call
                                expr2JuLISP
                                (parameters
                                    (...
                                        kw))
                                (::
                                    s
                                    String))
                            String)
                        (block
                            (call
                                repr
                                s))))
                (=
                    (::
                        (call
                            expr2JuLISP
                            (parameters
                                (...
                                    kw))
                            (::
                                c
                                Char))
                        String)
                    (block
                        (call
                            repr
                            c)))
                (=
                    (::
                        (call
                            expr2JuLISP
                            (parameters
                                (...
                                    kw))
                            (::
                                i
                                Integer))
                        String)
                    (block
                        (call
                            string
                            i)))
                (=
                    (::
                        (call
                            expr2JuLISP
                            (parameters
                                (...
                                    kw))
                            (::
                                f
                                AbstractFloat))
                        String)
                    (block
                        (call
                            string
                            f)))
                (=
                    (::
                        (call
                            expr2JuLISP
                            (parameters
                                (...
                                    kw))
                            (::
                                s
                                Symbol))
                        String)
                    (block
                        (call
                            String
                            s)))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ä¸»ä»£ç ï¼šæ•°ç»„â‡’æ‰¹é‡åŠ å…¥+å­ç¼©è¿›é€’å¢"
                    (=
                        (::
                            (call
                                expr2JuLISP
                                (parameters
                                    (kw
                                        (::
                                            indent
                                            Int)
                                        1)
                                    (kw
                                        (::
                                            indent_unit
                                            AbstractString)
                                        DEFAULT_INDENT_UNIT))
                                (::
                                    args
                                    Vector))
                            String)
                        (block
                            (call
                                join
                                (call
                                    filter!
                                    (call
                                        !
                                        isempty)
                                    (comprehension
                                        (generator
                                            (call
                                                expr2JuLISP
                                                (parameters
                                                    (kw
                                                        indent
                                                        (call
                                                            +
                                                            indent
                                                            1)))
                                                ex)
                                            (=
                                                ex
                                                args))))
                                (call
                                    _expr_indent
                                    indent_unit
                                    indent)))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "åˆ æ‰LineNumberNodeï¼ˆæš‚æ—¶çš„ï¼Ÿï¼‰"
                    (=
                        (::
                            (call
                                expr2JuLISP
                                (parameters
                                    (kw
                                        (::
                                            indent
                                            Int)
                                        1)
                                    (kw
                                        (::
                                            indent_unit
                                            AbstractString)
                                        DEFAULT_INDENT_UNIT))
                                (::
                                    lnn
                                    LineNumberNode))
                            String)
                        (block
                            "")))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ä¸»ä»£ç ä¹‹ä¸€ï¼šæ‹†åˆ†æˆã€Œå¤´ã€ã€Œå‚æ•°é›†ã€"
                    (=
                        (::
                            (call
                                expr2JuLISP
                                (parameters
                                    (kw
                                        (::
                                            indent
                                            Int)
                                        1)
                                    (kw
                                        (::
                                            indent_unit
                                            AbstractString)
                                        DEFAULT_INDENT_UNIT))
                                (::
                                    e
                                    Expr))
                            String)
                        (block
                            (string
                                "("
                                (.
                                    e
                                    (quote
                                        head))
                                (call
                                    _expr_indent
                                    indent_unit
                                    indent)
                                (call
                                    expr2JuLISP
                                    (parameters
                                        (kw
                                            indent
                                            indent))
                                    (.
                                        e
                                        (quote
                                            args)))
                                ")"))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ğŸ“Œè¿™ä¸ªåœ¨æ–‡æ¡£å­—ç¬¦ä¸²ä¸­å‡ºç°ã€‚ã€2023-09-26 16:26:09ã€‘ç›®å‰çš„è§£å†³åŠæ³•ï¼šè½¬æ¢ä¸ºã€ŒCode.var\"@doc\"ã€"
                    (=
                        (::
                            (call
                                expr2JuLISP
                                (parameters
                                    (...
                                        kw))
                                (::
                                    gr
                                    GlobalRef))
                            String)
                        (block
                            (call
                                expr2JuLISP
                                (parameters
                                    (...
                                        kw))
                                (call
                                    Expr
                                    (quote
                                        .)
                                    (call
                                        Symbol
                                        (.
                                            gr
                                            (quote
                                                mod)))
                                    (call
                                        Expr
                                        (quote
                                            quote)
                                        (call
                                            Symbol
                                            (.
                                                gr
                                                (quote
                                                    name)))))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "å¤„ç†ã€Œä¸²è”å¼•ç”¨ã€çš„æƒ…å†µ"
                    (=
                        (::
                            (call
                                expr2JuLISP
                                (parameters
                                    (...
                                        kw))
                                (::
                                    qn
                                    QuoteNode))
                            String)
                        (block
                            (call
                                expr2JuLISP
                                (parameters
                                    (...
                                        kw))
                                (call
                                    Expr
                                    (quote
                                        quote)
                                    (.
                                        qn
                                        (quote
                                            value)))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ç”Ÿæˆç¼©è¿›"
                    (=
                        (::
                            (call
                                _expr_indent
                                (parameters
                                    (kw
                                        (::
                                            newline
                                            Bool)
                                        true))
                                (::
                                    unit
                                    AbstractString)
                                (::
                                    n
                                    Integer))
                            String)
                        (block
                            (call
                                *
                                (if
                                    newline
                                    "\n"
                                    "")
                                (call
                                    ^
                                    unit
                                    n))))))
            (block
                "JuLISP => S-Expr"
                (const
                    (=
                        JuLISPAtom
                        (curly
                            Union
                            Symbol
                            String
                            Char
                            Number
                            Bool)))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "å­—ç¬¦ä¸² â†’ S-è¡¨è¾¾å¼ã®å€¼\n- è‹¥å…¶ä¸­å«æœ‰ç©ºç™½ç¬¦ï¼Œéœ€è¦ä½¿ç”¨å¼•å·è½¬ä¹‰\n    - ç¤ºä¾‹ï¼š`123 123` --> `\"123 123\"`\n    - è½¬ä¹‰ï¼šä½¿ç”¨`Base.repr`æ–¹æ³•\n    - é€†è½¬ä¹‰ï¼šä½¿ç”¨`Meta.parse`æ–¹æ³•ï¼ˆä¸æ‰§è¡Œä»£ç ï¼‰\n"
                    (=
                        (::
                            (call
                                s_expr
                                (parameters
                                    (kw
                                        (::
                                            always_escape
                                            Bool)
                                        false))
                                (::
                                    str
                                    AbstractString))
                            AbstractString)
                        (block
                            (if
                                (||
                                    always_escape
                                    (call
                                        any
                                        isspace
                                        str))
                                (call
                                    (.
                                        Base
                                        (quote
                                            repr))
                                    str)
                                str))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "åŸç”Ÿæ•°ç»„â†’S-è¡¨è¾¾å¼\n\nç¤ºä¾‹ï¼š\n    `[\"A\", \"sp ace\", [\"2\", \"3\"], \"B\"]` --> `(A \"sp ace\" (2 3) B)`\n"
                    (=
                        (::
                            (call
                                s_expr
                                (parameters
                                    (kw
                                        (::
                                            always_escape
                                            Bool)
                                        false))
                                (::
                                    obj
                                    (curly
                                        Vector
                                        (curly
                                            Union
                                            Vector
                                            JuLISPAtom))))
                            String)
                        (block
                            (call
                                *
                                '('
                                (call
                                    join
                                    (.
                                        s_expr
                                        (tuple
                                            (parameters
                                                always_escape)
                                            obj))
                                    ' ')
                                ')'))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "å¼€/é—­æ‹¬å¼§ + å¼•å·"
                    (const
                        (=
                            (::
                                S_EXPR_OPEN_BRACKET
                                Char)
                            '(')))
                (const
                    (=
                        (::
                            S_EXPR_CLOSE_BRACKET
                            Char)
                        ')'))
                (const
                    (=
                        (::
                            S_EXPR_QUOTE
                            Char)
                        '"'))
                (const
                    (=
                        (::
                            S_EXPR_SEMI_QUOTE
                            Char)
                        '\''))
                (const
                    (=
                        (::
                            S_EXPR_BACK_QUOTE
                            Char)
                        '`'))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "S"
                    (function
                        (::
                            (call
                                str2sexpr_all
                                (::
                                    str
                                    AbstractString))
                            (curly
                                Tuple
                                (curly
                                    Vararg
                                    Vector)))
                        (block
                            (=
                                str
                                (call
                                    strip
                                    str))
                            "è¿”å›å€¼ç±»å‹"
                            (=
                            exprs
                                (vect
                                    ))
                            "èµ·å§‹å€¼"
                            (local
                                (=
                                    (tuple
                                        (::
                                            tempSExpr
                                            Vector)
                                        (::
                                            next_start
                                            Int))
                                    (call
                                        _str2sexpr
                                        str
                                        1)))
                            (while
                                (call
                                    !
                                    (call
                                        isempty
                                        str))
                                (block
                                    (call
                                        push!
                                        exprs
                                        tempSExpr)
                                    (=
                                        str
                                        (call
                                            strip
                                            (macrocall
                                                @view
                                                (ref
                                                    str
                                                    (call
                                                        :
                                                        (call
                                                            nextind
                                                            str
                                                            next_start
                                                            1)
                                                        end)))))
                                    (if
                                        (call
                                            isempty
                                            str)
                                        (block
                                            (return
                                                (call
                                                    tuple
                                                    (...
                                                        exprs)))))
                                    (=
                                        (tuple
                                            tempSExpr
                                            next_start)
                                        (call
                                            _str2sexpr
                                            str))))
                            (call
                                error
                                "ä½ ä¼¼ä¹æ¥åˆ°äº†æ²¡æœ‰ç»“æœçš„è’åŸ"))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "S-è¡¨è¾¾å¼ â†’ æ•°ç»„ï¼ˆå•ä¸ªï¼‰\n- å‚æ•°é›†ï¼š\n    - strï¼šè¢«è§£æçš„å­—ç¬¦ä¸²æ•´ä½“\n    - startï¼šè§£æçš„å¼€å§‹ä½ç½®\n        - å†³å®šä¼šåœ¨è§£æåˆ°ä½•æ—¶åœæ­¢ï¼ˆä¸startä½ç½®åŒçº§çš„ä¸‹ä¸€ä¸ªé—­æ‹¬å¼§ï¼‰\n        - ç”¨äºé€’å½’è§£æ\n\nç¤ºä¾‹ï¼š`(A (B C D) E \"spa ce\" 'c')` --> `[:A, [:B, :C, :D], :E, \"spa ce\", 'c']`\n"
                    (=
                        (::
                            (call
                                str2sexpr
                                (::
                                    str
                                    AbstractString))
                            Vector)
                        (block
                            (ref
                                (call
                                    _str2sexpr
                                    str)
                                1))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "å†…éƒ¨çš„è§£æé€»è¾‘ï¼š\n- è¿”å›: (å€¼, åŸå­—ä¸²strä¸Šè§£æçš„æœ€åä¸€ä¸ªç´¢å¼•)\n"
                    (function
                        (::
                            (call
                                _str2sexpr
                                (parameters
                                    (kw
                                        end_i
                                        (call
                                            lastindex
                                            s)))
                                (::
                                    s
                                    AbstractString)
                                (kw
                                    (::
                                        start
                                        Integer)
                                    1))
                            (curly
                                Tuple
                                Vector
                                Int))
                        (block
                            (||
                                (call
                                    ==
                                    (ref
                                        s
                                        start)
                                    S_EXPR_OPEN_BRACKET)
                                (call
                                    throw
                                    (call
                                        ArgumentError
                                        (string
                                            "S-è¡¨è¾¾å¼å¿…é¡»ä»¥ã€(ã€ä¸ºèµ·å§‹å­—ç¬¦ï¼š"
                                            s))))
                            (local
                                (=
                                    (::
                                        result
                                        (curly
                                            Vector
                                            (curly
                                                Union
                                                Vector
                                                JuLISPAtom)))
                                    (ref
                                        (curly
                                            Union
                                            Vector
                                            String))))
                            (local
                                (=
                                    (::
                                        i
                                        Int)
                                    start))
                            (local
                                (::
                                    si
                                    Char))
                            (local
                                (::
                                    next_index
                                    Int))
                            (while
                                true
                                (block
                                    (=
                                        i
                                        (call
                                            nextind
                                            s
                                            i))
                                    (&&
                                        (call
                                            >
                                            i
                                            end_i)
                                        (call
                                            error
                                            (string
                                                "åœ¨ç´¢å¼•ã€Œ"
                                                start
                                                ":"
                                                i
                                                ":"
                                                end_i
                                                "ã€å¤„å‘ç°æ— æ•ˆçš„S-è¡¨è¾¾å¼ã€Œ"
                                                s
                                                "ã€"
                                                result)))
                                    (=
                                        si
                                        (ref
                                            s
                                            i))
                                    (if
                                        (call
                                            ==
                                            si
                                            S_EXPR_OPEN_BRACKET)
                                        (block
                                            (=
                                                (tuple
                                                    (::
                                                        vec
                                                        Vector)
                                                    i_sub_end)
                                                (call
                                                    _str2sexpr
                                                    (parameters
                                                        (kw
                                                            end_i
                                                            end_i))
                                                    s
                                                    i))
                                            (call
                                                push!
                                                result
                                                vec)
                                            (=
                                                i
                                                i_sub_end))
                                        (elseif
                                            (block
                                                (call
                                                    ==
                                                    si
                                                    S_EXPR_CLOSE_BRACKET))
                                            (block
                                                (return
                                                    (tuple
                                                        result
                                                        i)))
                                            (elseif
                                                (block
                                                    (call
                                                        !
                                                        (call
                                                            isspace
                                                            si)))
                                                (block
                                                    (=
                                                        (tuple
                                                            (::
                                                                str
                                                                JuLISPAtom)
                                                            i_sub_end)
                                                        (call
                                                            str2sexpr_atom
                                                            (parameters
                                                                (kw
                                                                    start_i
                                                                    i)
                                                                (kw
                                                                    end_i
                                                                    end_i))
                                                            s
                                                            si))
                                                    (call
                                                        push!
                                                        result
                                                        str)
                                                    (=
                                                        i
                                                        i_sub_end))))))))))
                (=
                    (::
                        (call
                            str2sexpr_atom
                            (parameters
                                (kw
                                    start_i
                                    1)
                                (kw
                                    end_i
                                    (call
                                        lastindex
                                        s)))
                            (::
                                s
                                AbstractString)
                            (kw
                                (::
                                    si
                                    AbstractChar)
                                (ref
                                    s
                                    1)))
                        (curly
                            Tuple
                            JuLISPAtom
                            Int))
                    (block
                        (if
                            (call
                                ===
                                si
                                S_EXPR_QUOTE)
                            (call
                                _parse_escaped_s_expr_string
                                (parameters
                                    end_i)
                                s
                                start_i)
                            (if
                                (call
                                    ===
                                    si
                                    S_EXPR_SEMI_QUOTE)
                                (call
                                    _parse_escaped_s_expr_char
                                    (parameters
                                        end_i)
                                    s
                                    start_i)
                                (if
                                    (call
                                        ===
                                        si
                                        S_EXPR_BACK_QUOTE)
                                    (call
                                        _parse_escaped_s_expr_cmd
                                        (parameters
                                            end_i)
                                        s
                                        start_i)
                                    (if
                                        (call
                                            isdigit
                                            si)
                                        (call
                                            _parse_escaped_s_expr_number
                                            (parameters
                                                end_i)
                                            s
                                            start_i)
                                        (call
                                            _str2sexpr_symbol
                                            (parameters
                                                end_i)
                                            s
                                            start_i)))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ç‰¹æ®Šï¼šè§£æS-è¡¨è¾¾å¼ä¸­çš„åŸå­å€¼ï¼ˆè¡¨è¾¾å¼ï¼‰\n- æœªè½¬ä¹‰ï¼šå¼€å¤´æ— å¼•å·\n- å·²è½¬ä¹‰ï¼šå¼€å¤´æœ‰å¼•å·(å¦å¤–å®ç°ï¼ŒåŒæ—¶åŒ…æ‹¬ç”¨å•å¼•å·æ‹¬èµ·æ¥çš„ã€Œå­—ç¬¦ã€)\n- æ•°å­—ï¼šå¼€å¤´æ˜¯æ•°å€¼å­—ç¬¦ï¼ˆæ•´æ•°/æµ®ç‚¹æ•°åœ¨æ›´ç»†ä¸€æ­¥çš„åœ°æ–¹åˆ¤æ–­ï¼‰\n- âš åªå…³æ³¨ã€Œæ˜¯å¦æœ‰ç©ºæ ¼/æ˜¯å¦é‡åˆ°æœªè½¬ä¹‰å¼•å·ã€ï¼Œä¸æ£€æµ‹æ‹¬å¼§\n\nè¿”å›å€¼ï¼š\n- (è§£æå¥½çš„å­—ç¬¦ä¸²/ç¬¦å·å€¼/æ•°å€¼ï¼ˆéœ€è¦è½¬ä¹‰çš„ä¹Ÿå·²ç»è½¬ä¹‰ï¼‰, åŸå­—ä¸²strä¸Šè§£æçš„æœ€åä¸€ä¸ªç´¢å¼•)\n\nç¤ºä¾‹ï¼š\n`A123` --> :A123\n`137.442` --> 137.442\n`'c'` --> 'c'\n`\"spac e()\"` --> \"spac e()\"\n"
                    (function
                        (::
                            (call
                                _str2sexpr_symbol
                                (parameters
                                    (kw
                                        end_i
                                        (call
                                            lastindex
                                            s)))
                                (::
                                    s
                                    AbstractString)
                                (kw
                                    (::
                                        start
                                        Integer)
                                    1))
                            (curly
                                Tuple
                                Symbol
                                Int))
                        (block
                            (local
                                (=
                                    (::
                                        start_i
                                        Int)
                                    start))
                            (local
                                (=
                                    (::
                                        i
                                        Int)
                                    start))
                            (local
                                (=
                                    (::
                                        si
                                        Char)
                                    (ref
                                        s
                                        i)))
                            (while
                                (&&
                                    (call
                                        !
                                        (call
                                            isspace
                                            si))
                                    (call
                                        !=
                                        si
                                        S_EXPR_CLOSE_BRACKET))
                                (block
                                    (=
                                        i
                                        (call
                                            nextind
                                            s
                                            i))
                                    (&&
                                        (call
                                            >
                                            i
                                            end_i)
                                        (call
                                            error
                                            (string
                                                "æ— æ•ˆçš„S-è¡¨è¾¾å¼ã€Œ"
                                                s
                                                "ã€")))
                                    (=
                                        si
                                        (ref
                                            s
                                            i))))
                            (return
                                (tuple
                                    (call
                                        Symbol
                                        (macrocall
                                            @view
                                            (ref
                                                s
                                                (call
                                                    :
                                                    start_i
                                                    (call
                                                        prevind
                                                        s
                                                        i)))))
                                    (call
                                        prevind
                                        s
                                        i))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "è§£æã€Œéœ€è¦è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€\n- startï¼šéœ€è½¬ä¹‰å­—ç¬¦ä¸²åœ¨ä¸€å¼€å§‹æ‰€å¤„çš„ä½ç½®ï¼ˆå·¦ä¾§å¼•å·ã€Œ\"ã€çš„ä½ç½®ï¼‰\n"
                    (=
                        (::
                            (call
                                _parse_escaped_s_expr_string
                                (parameters
                                    (kw
                                        end_i
                                        (call
                                            lastindex
                                            s)))
                                (::
                                    s
                                    AbstractString)
                                (kw
                                    (::
                                        start
                                        Integer)
                                    1))
                            (curly
                                Tuple
                                String
                                Int))
                        (block
                            (call
                                _parse_escaped_s_expr_str
                                (parameters
                                    end_i)
                                S_EXPR_QUOTE
                                s
                                start))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "è§£æã€Œéœ€è¦è½¬ä¹‰çš„å­—ç¬¦ã€\n\nã€2023-09-26 15:10:31ã€‘ç°åœ¨éœ€è¦è€ƒè™‘è§£å†³ã€Œå¶æ•°ä¸ªè½¬ä¹‰ç¬¦ã€çš„æƒ…å†µ\n- å¦‚`'asd fgh \\\\'`\n"
                    (=
                        (::
                            (call
                                _parse_escaped_s_expr_char
                                (parameters
                                    (kw
                                        end_i
                                        (call
                                            lastindex
                                            s)))
                                (::
                                    s
                                    AbstractString)
                                (kw
                                    (::
                                        start
                                        Integer)
                                    1))
                            (curly
                                Tuple
                                Char
                                Int))
                        (block
                            (call
                                _parse_escaped_s_expr_str
                                (parameters
                                    end_i)
                                S_EXPR_SEMI_QUOTE
                                s
                                start))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "è§£æã€Œéœ€è¦è½¬ä¹‰çš„å‘½ä»¤ã€\n- startï¼šéœ€è½¬ä¹‰å­—ç¬¦ä¸²åœ¨ä¸€å¼€å§‹æ‰€å¤„çš„ä½ç½®ï¼ˆå·¦ä¾§å¼•å·ã€Œ`ã€çš„ä½ç½®ï¼‰\n"
                    (=
                        (::
                            (call
                                _parse_escaped_s_expr_cmd
                                (parameters
                                    (kw
                                        end_i
                                        (call
                                            lastindex
                                            s)))
                                (::
                                    s
                                    AbstractString)
                                (kw
                                    (::
                                        start
                                        Integer)
                                    1))
                            (curly
                                Tuple
                                String
                                Int))
                        (block
                            (call
                                _parse_escaped_s_expr_str
                                (parameters
                                    end_i)
                                S_EXPR_BACK_QUOTE
                                s
                                start))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "é€šç”¨çš„è§£æã€Œå‰åå¼•ç”¨ã€çš„æ–¹å¼\n- å­—ç¬¦ä¸²ã€Œ\"ã€\n- å­—ç¬¦ã€Œ'ã€\n- å‘½ä»¤ã€Œ`ã€\n"
                    (function
                        (::
                            (call
                                _parse_escaped_s_expr_str
                                (parameters
                                    (kw
                                        end_i
                                        (call
                                            lastindex
                                            s)))
                                (::
                                    embrace
                                    AbstractChar)
                                (::
                                    s
                                    AbstractString)
                                (kw
                                    (::
                                        start
                                        Integer)
                                    1))
                            (curly
                                Tuple
                                Any
                                Int))
                        (block
                            (local
                                (=
                                    (::
                                        num_backslash
                                        Int)
                                    0))
                            (local
                                (=
                                    (::
                                        start_i
                                        Int)
                                    (call
                                        nextind
                                        s
                                        start)))
                            (local
                                (=
                                    (::
                                        i
                                        Int)
                                    start_i))
                            (&&
                                (call
                                    >
                                    i
                                    end_i)
                                (call
                                    error
                                    (string
                                        "æ— æ•ˆçš„S-è¡¨è¾¾å¼ã€Œ"
                                        s
                                        "ã€")))
                            (while
                                true
                                (block
                                    (=
                                        si
                                        (ref
                                            s
                                            i))
                                    (if
                                        (call
                                            ===
                                            si
                                            '\\')
                                        (block
                                            (+=
                                                num_backslash
                                                1))
                                        (block
                                            (if
                                                (&&
                                                    (call
                                                        ==
                                                        si
                                                        embrace)
                                                    (call
                                                        iseven
                                                        num_backslash))
                                                (block
                                                    (return
                                                        (tuple
                                                            (call
                                                                (.
                                                                    Meta
                                                                    (quote
                                                                        parse))
                                                                (macrocall
                                                                    @view
                                                                    (ref
                                                                        s
                                                                        (call
                                                                            :
                                                                            start
                                                                            i))))
                                                            i))))
                                            (=
                                                num_backslash
                                                0)))
                                    (=
                                        i
                                        (call
                                            nextind
                                            s
                                            i))
                                    (&&
                                        (call
                                            >
                                            i
                                            end_i)
                                        (call
                                            error
                                            (string
                                                "æ— æ•ˆçš„S-è¡¨è¾¾å¼ã€Œ"
                                                s
                                                "ã€")))
                                    (=
                                        si
                                        (ref
                                            s
                                            i)))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "è§£ææ•°å€¼"
                    (function
                        (::
                            (call
                                _parse_escaped_s_expr_number
                                (parameters
                                    (kw
                                        end_i
                                        (call
                                            lastindex
                                            s)))
                                (::
                                    s
                                    AbstractString)
                                (kw
                                    (::
                                        start
                                        Integer)
                                    1))
                            (curly
                                Tuple
                                Number
                                Int))
                        (block
                            (local
                                (=
                                    (::
                                        start_i
                                        Int)
                                    (call
                                        nextind
                                        s
                                        start)))
                            (local
                                (=
                                    (::
                                        i
                                        Int)
                                    start_i))
                            (&&
                                (call
                                    >
                                    i
                                    end_i)
                                (call
                                    error
                                    (string
                                        "æ— æ•ˆçš„S-è¡¨è¾¾å¼ã€Œ"
                                        s
                                        "ã€")))
                            (while
                                true
                                (block
                                    (=
                                        si
                                        (ref
                                            s
                                            i))
                                    (if
                                        (||
                                            (call
                                                isspace
                                                si)
                                            (call
                                                ===
                                                si
                                                S_EXPR_CLOSE_BRACKET))
                                        (block
                                            (return
                                                (tuple
                                                    (call
                                                        (.
                                                            Meta
                                                            (quote
                                                                parse))
                                                        (macrocall
                                                            @view
                                                            (ref
                                                                s
                                                                (call
                                                                    :
                                                                    start
                                                                    (call
                                                                        prevind
                                                                        s
                                                                        i
                                                                        1)))))
                                                    (call
                                                        prevind
                                                        s
                                                        i
                                                        1)))))
                                    (=
                                        i
                                        (call
                                            nextind
                                            s
                                            i))
                                    (&&
                                        (call
                                            >
                                            i
                                            end_i)
                                        (call
                                            error
                                            (string
                                                "æ— æ•ˆçš„S-è¡¨è¾¾å¼ã€Œ"
                                                s
                                                "ã€")))
                                    (=
                                        si
                                        (ref
                                            s
                                            i))))))))
            (block
                "S-Expr => Julia AST"
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ï¼ˆåªä¼šåœ¨:macrocallè¯­å¢ƒä¸‹æ‰§è¡Œï¼‰è¯†åˆ«æ˜¯å¦æ˜¯å…ˆå‰æ‰“åŒ…çš„GlobalRef"
                    (=
                        (call
                            _isPackedGlobalRef
                            (::
                                v
                                Vector))
                        (block
                            (&&
                                (call
                                    >
                                    (call
                                        length
                                        v)
                                    1)
                                (&&
                                    (call
                                        ===
                                        (macrocall
                                            @inbounds
                                            (ref
                                                v
                                                1))
                                        (quote
                                            call))
                                    (call
                                        ===
                                        (macrocall
                                            @inbounds
                                            (ref
                                                v
                                                2))
                                        (quote
                                            GlobalRef)))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "æ•°ç»„ç±»å‹â‡’å–å¤´æ˜ å°„ | å¯¹ã€Œå®è°ƒç”¨ã€æ·»åŠ è¡Œå·"
                    (function
                        (::
                            (call
                                sexpr2expr
                                (parameters
                                    (kw
                                        (::
                                            l_num
                                            Int)
                                        0))
                                (::
                                    s_arr
                                    (curly
                                        Vector
                                        (curly
                                            Union
                                            Vector
                                            JuLISPAtom))))
                            Expr)
                        (block
                            (&&
                                (call
                                    <
                                    (call
                                        length
                                        s_arr)
                                    1)
                                (call
                                    error
                                    (string
                                        "è¡¨è¾¾å¼ã€Œ"
                                        s_arr
                                        "ã€è‡³å°‘å¾—æœ‰ä¸€ä¸ªå…ƒç´ ï¼")))
                            (return
                                (if
                                    (call
                                        ===
                                        (macrocall
                                            @inbounds
                                            (ref
                                                s_arr
                                                1))
                                        (quote
                                            macrocall))
                                    (call
                                        Expr
                                        (macrocall
                                            @inbounds
                                            (ref
                                                s_arr
                                                1))
                                        (call
                                            sexpr2expr
                                            (ref
                                                s_arr
                                                2))
                                        (call
                                            LineNumberNode
                                            l_num
                                            "none")
                                        (...
                                            (call
                                                map
                                                sexpr2expr
                                                (macrocall
                                                    @inbounds
                                                    (ref
                                                        s_arr
                                                        (call
                                                            :
                                                            3
                                                            end))))))
                                    (call
                                        Expr
                                        (macrocall
                                            @inbounds
                                            (ref
                                                s_arr
                                                1))
                                        (...
                                            (call
                                                map
                                                sexpr2expr
                                                (macrocall
                                                    @inbounds
                                                    (ref
                                                        s_arr
                                                        (call
                                                            :
                                                            2
                                                            end)))))))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "åŸºç¡€ç±»å‹â‡’åŸæ ·è¿”å›"
                    (=
                        (::
                            (call
                                sexpr2expr
                                (::
                                    s_val
                                    JuLISPAtom))
                            JuLISPAtom)
                        (block
                            s_val)))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ç±»ä¼¼`Meta.parse`ï¼ŒæŠŠJuLISPå­—ç¬¦ä¸²è½¬æ¢æˆJuliaè¡¨è¾¾å¼\n- ä¸ä¼šåƒ\n"
                    (=
                        (::
                            (call
                                parse_julisp
                                (::
                                    str
                                    AbstractString))
                            Expr)
                        (block
                            (call
                                |>
                                (call
                                    |>
                                    str
                                    str2sexpr)
                                sexpr2expr))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ï¼ˆä¸å¯¼å‡ºï¼‰ä¸Šé¢`parse_julisp`çš„åˆ«å"
                    (=
                        (::
                            (call
                                parse
                                (::
                                    str
                                    AbstractString))
                            Expr)
                        (block
                            (call
                                parse_julisp
                                str))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ç±»ä¼¼`Meta.parseall`ï¼šä¼šè‡ªåŠ¨æŠŠã€Œå¤šä¸ªæ–‡æœ¬ã€"
                    (=
                        (::
                            (call
                                parseall_julisp
                                (::
                                    str
                                    AbstractString))
                            Expr)
                        (block
                            (call
                                |>
                                (call
                                    .|>
                                    (call
                                        |>
                                        str
                                        str2sexpr_all)
                                    sexpr2expr)
                                _auto_toplevel))))
                (=
                    (::
                        (call
                            parseall
                            (::
                                str
                                AbstractString))
                        Expr)
                    (block
                        (call
                            parseall_julisp
                            str)))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "è‡ªåŠ¨æ ¹æ®ã€Œè¡¨è¾¾å¼æ˜¯å¦åªæœ‰ä¸€ä¸ªã€æ·»åŠ ã€Œé¡¶å±‚ã€è¡¨è¾¾å¼å¤´:toplevel"
                    (=
                        (::
                            (call
                                _auto_toplevel
                                (::
                                    exs
                                    (curly
                                        Tuple
                                        (curly
                                            Vararg
                                            Expr))))
                            Expr)
                        (block
                            (if
                                (call
                                    ===
                                    (call
                                        length
                                        exs)
                                    1)
                                (macrocall
                                    @inbounds
                                    (ref
                                        exs
                                        1))
                                (call
                                    Expr
                                    (quote
                                        toplevel)
                                    (...
                                        exs)))))))
            (block
                "ä¸´é—¨ä¸€è„šï¼šç»„åˆ&æ‰§è¡Œ"
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ï¼ˆæ— é”™è¯¯æ£€æŸ¥åŠŸèƒ½ï¼‰å…¥å£æ–¹æ³•ï¼šè¿è¡ŒJuLISPä»£ç \n"
                    (=
                        (::
                            (call
                                run_julisp
                                (parameters
                                    (kw
                                        (::
                                            eval_F
                                            Function)
                                        (.
                                            Main
                                            (quote
                                                eval))))
                                (::
                                    str
                                    AbstractString))
                            Any)
                        (block
                            (ref
                                (call
                                    .|>
                                    (call
                                        .|>
                                        (call
                                            |>
                                            str
                                            str2sexpr_all)
                                        sexpr2expr)
                                    eval_F)
                                end))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ï¼ˆä¸å¯¼å‡ºï¼‰ä¸Šé¢`run_julisp`çš„åˆ«å"
                    (=
                        (::
                            (call
                                run
                                (parameters
                                    (kw
                                        (::
                                            eval_F
                                            Function)
                                        (.
                                            Main
                                            (quote
                                                eval))))
                                (::
                                    str
                                    AbstractString))
                            Any)
                        (block
                            (call
                                run_julisp
                                (parameters
                                    eval_F)
                                str))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "å…¥å£æ–¹æ³•ï¼šè¿è¡ŒJuLISPä»£ç \n- é€»è¾‘ï¼šå°†JuLISPä»£ç è§£ææˆS-è¡¨è¾¾å¼ï¼Œå†ç¿»è¯‘æˆJulia ASTï¼Œç„¶åç›´æ¥æ‰§è¡Œ\n  - å…¶è¿”å›å€¼åŒJuliaï¼Œä¹Ÿæ˜¯æœ€åä¸€ä¸ªè¡¨è¾¾å¼è¿”å›çš„å€¼\n- å‚æ•° `tryEval`ï¼šæ˜¯å¦ä½¿ç”¨try-catchçš„æ–¹å¼è¿è¡Œä»£ç \n  - ä¸æä¾›â‡’ç›´æ¥è§£é‡Šæ‰§è¡Œ\n  - `true`â‡’æ¯æ¬¡try & catchåç»§ç»­æ‰§è¡Œ\n  - `false`â‡’æ¯æ¬¡try & catchåä¸å†æ‰§è¡Œ\n"
                    (function
                        (::
                            (call
                                run_julisp
                                (parameters
                                    (kw
                                        (::
                                            eval_F
                                            Function)
                                        (.
                                            Main
                                            (quote
                                                eval))))
                                (::
                                    str
                                    AbstractString)
                                (::
                                    try_eval
                                    Bool))
                            Any)
                        (block
                            (local
                                (=
                                    (::
                                        exprs
                                        (curly
                                            Tuple
                                            (curly
                                                Vararg
                                                Expr)))
                                    (call
                                        .|>
                                        (call
                                            |>
                                            str
                                            str2sexpr_all)
                                        sexpr2expr)))
                            (local
                                (::
                                    current_result
                                    Any))
                            (for
                                (=
                                    (::
                                        expr
                                        Expr)
                                    exprs)
                                (block
                                    (try
                                        (block
                                            (=
                                                current_result
                                                (call
                                                    eval_F
                                                    expr)))
                                        e
                                        (block
                                            (macrocall
                                                @error
                                                "æ‰§è¡Œè¡¨è¾¾å¼æ—¶å‡ºé”™ï¼"
                                                expr
                                                e)
                                            (=
                                                current_result
                                                nothing)
                                            (||
                                                try_eval
                                                (break
                                                    ))))))
                            (return
                                current_result))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "å†™ä¸€ä¸ªå­—ç¬¦ä¸²å®ï¼Œç›´æ¥æ‰§è¡Œâœ“"
                    (function
                        (::
                            (call
                                JuLISP_str_macro
                                (parameters
                                    (kw
                                        (::
                                            eval_F
                                            Function)
                                        (.
                                            Main
                                            (quote
                                                eval))))
                                (::
                                    str
                                    AbstractString))
                            Expr)
                        (block
                            (return
                                (quote
                                    (call
                                        run_julisp
                                        ($
                                            str)))))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "é€šè¿‡ç®€å•çš„å­—ç¬¦ä¸²è°ƒç”¨ï¼Œè‡ªåŠ¨è§£é‡Šæ‰§è¡ŒJuLISPä»£ç "
                    (macro
                        (call
                            julisp_str
                            (::
                                str
                                AbstractString))
                        (block
                            (return
                                (call
                                    JuLISP_str_macro
                                    str)))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ï¼ˆç®€å†™åï¼‰é€šè¿‡ç®€å•çš„å­—ç¬¦ä¸²è°ƒç”¨ï¼Œè‡ªåŠ¨è§£é‡Šæ‰§è¡ŒJuLISPä»£ç "
                    (macro
                        (call
                            jls_str
                            (::
                                str
                                AbstractString))
                        (block
                            (return
                                (call
                                    JuLISP_str_macro
                                    str)))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨è§£é‡Šæ‰§è¡Œå…¶ä¸­çš„JuLISPä»£ç "
                    (=
                        (::
                            (call
                                include_julisp
                                (parameters
                                    (...
                                        kw))
                                (::
                                    path
                                    AbstractString)
                                (...
                                    args))
                            Any)
                        (block
                            (call
                                run_julisp
                                (parameters
                                    (...
                                        kw))
                                (call
                                    |>
                                    (call
                                        |>
                                        path
                                        read)
                                    String)
                                (...
                                    args)))))
                (macrocall
                    (.
                        Core
                        (quote
                            @doc))
                    "ï¼ˆä¸å¯¼å‡ºï¼‰ä¸Šé¢`include_julisp`çš„åˆ«å"
                    (=
                        (::
                            (call
                                include
                                (parameters
                                    (...
                                        kw))
                                (::
                                    str
                                    AbstractString)
                                (...
                                    args))
                            Any)
                        (block
                            (call
                                include_julisp
                                (parameters
                                    (...
                                        kw))
                                str
                                (...
                                    args)))))))))